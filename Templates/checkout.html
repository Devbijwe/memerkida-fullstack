{% extends "layout.html" %}{% block style %}
<style>
    @import url(https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/5.3.45/css/materialdesignicons.min.css);
</style>{% endblock %}{% block main %}

<div class="min-w-screen min-h-screen bg-yellow-300 flex items-center p-5 lg:p-10 overflow-hidden relative" style="background-color: whitesmoke;">
    <div class="w-full max-w-6xl rounded bg-white shadow-xl p-10 lg:p-20 mx-auto text-gray-800 relative md:text-left " style="background-image: linear-gradient(to top, lightgrey 0%, lightgrey 1%, #e0e0e0 26%, #efefef 48%, #d9d9d9 75%, #bcbcbc 100%);">

        {% if source=="noCart" %}
        <form action="/{{tshirtId}}=t/{{printId}}=p/{{answerId}}=a/{{type}}/{{source}}/checkout" method="post" enctype="multipart/form-data">
            {% else %}
            <form action="/{{cartId}}=t/{{printId}}=p/{{answerId}}=a/{{type}}/{{source}}/checkout" method="post" enctype="multipart/form-data">{% endif %}
                <div class="md:flex items-center -mx-10">
                    <div class="w-full md:w-1/2 px-10 mb-10 md:mb-0" id="colorDisplay">

                        <!-- <h1 class="font-bold uppercase text-2xl mb-5 space-x-34">Demo Product</h1> -->
                        <div class="relative">
                            {% if type =="customize" %}
                            <img src="/static/customers/editedImages/tshirts/{{post_name}}" class="w-100 h-50 relative z-10" alt=""> {% elif type=="default" %}
                            <img src="/static/files/samplePostsTshirts/{{post_name}}" class="w-100 h-50 relative z-10" alt=""> {% endif %}
                            <div class="border-4 border-yellow-200 absolute top-10 bottom-10 left-10 right-10 z-0" id="colorDisplay"></div>
                        </div>
                    </div>
                    <div class="w-full md:w-1/2 px-10">
                        <div class="mb-10">
                            <h1 class="font-bold uppercase text-2xl mb-5">{{title}}</h1>
                            <input type="text" class="hidden" name="details" id="details" value="{{title}}">
                            <p class="text-sm">{{description}} </p>
                        </div>
                        <div class="mb-10 flex justify-around capitalize">
                            <div class="flex flex-col">
                                <p class="text-xl ">Neck Type: </p>
                                <p class="text-xl font-semibold">{{neck}} </p>
                            </div>
                            <div class="flex flex-col">
                                <p class="text-xl ">Sleeves: </p>
                                <p class="text-xl font-semibold">{{sleeve}} </p>
                            </div>
                        </div>
                        <!-- color -->
                        <!-- component -->
                        <!-- This is an example component -->
                        <div class="space-y-4   text-center">
                            <div class="relative mx-5 inline-flex">
                                <svg class="w-2 h-2 absolute top-0 right-0 m-4 pointer-events-none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 412 232"><path d="M206 171.144L42.678 7.822c-9.763-9.763-25.592-9.763-35.355 0-9.763 9.764-9.763 25.592 0 35.355l181 181c4.88 4.882 11.279 7.323 17.677 7.323s12.796-2.441 17.678-7.322l181-181c9.763-9.764 9.763-25.592 0-35.355-9.763-9.763-25.592-9.763-35.355 0L206 171.144z" fill="#648299" fill-rule="nonzero"/></svg>
                                <select name="colour" id="colour" class="border border-gray-300 rounded-full text-gray-600 h-10 pl-5 pr-10 bg-white hover:border-gray-400 focus:outline-none appearance-none" required>
                                {% if source=="noCart" %}       <option value="">Color</option>
                                {% for key in colour %}
                               
    <option value="{{key}}" class="capitalize">{{key}}</option>
                                {% endfor %}
                                {% else %}<option value="{{colour}}">{{colour}}</option>{% endif %}
  </select>
                            </div>
                            <!-- component -->
                            <!-- This is an example component -->
                            <div class="relative mx-5 inline-flex">
                                <svg class="w-2 h-2 absolute top-0 right-0 m-4 pointer-events-none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 412 232"><path d="M206 171.144L42.678 7.822c-9.763-9.763-25.592-9.763-35.355 0-9.763 9.764-9.763 25.592 0 35.355l181 181c4.88 4.882 11.279 7.323 17.677 7.323s12.796-2.441 17.678-7.322l181-181c9.763-9.764 9.763-25.592 0-35.355-9.763-9.763-25.592-9.763-35.355 0L206 171.144z" fill="#648299" fill-rule="nonzero"/></svg>
                                <select name="size" id="size" class="border border-gray-300 rounded-full text-gray-600 h-10 pl-5 pr-10 bg-white hover:border-gray-400 focus:outline-none appearance-none" required>
    
    {% if source=="noCart" %}                        <option value="">Size</option>
    {% for key in size %}
                               
    <option value="{{key}}" class="capitalize">{{key}}</option>
                                {% endfor %}
                                {% else %}<option value="{{colour}}">{{size}}</option>{% endif %}
  
    
  </select>
                            </div>
                            <div class="relative flex flex-col  ">
                                <label class="mb-2" for="quantity">Quantity :</label>
                                <div class="mx-auto  flex  md:flex-row">
                                    {% if source=="noCart" %}
                                    <button id="minusBtn" type="button" onclick="qunatityUpdate('minus')" class="btn text-red-500 px-2 py-1 rounded-full">-</button>

                                    <input required type="number" disabled onchange="update()" id="quantityDisplay" value="{{quantity}}" class="text-center w-[100px] bg-gray-100 px-2 py-1 rounded-full"> <button id="plusBtn" type="button" onclick="qunatityUpdate('plus')"
                                        class="btn text-green-500 px-2 py-1 rounded-full">+</button>{% else %}
                                    <input required type="number" id="quantityDisplay" disabled value="{{quantity}}" class="text-center w-[100px] bg-gray-100 px-2 py-1 rounded-full"> {% endif %}
                                    <input required type="number" name="quantity" onchange="update()" id="quantity" value="{{quantity}}" class="text-center hidden w-[100px] bg-gray-100 px-2 py-1 rounded-full"></div>
                            </div>
                        </div>
                        <div class="space-y-3 my-2 text-center">
                            <div class="inline-block align-bottom mr-5 space-y-5">
                                <div class="mb-2">
                                    <span class="font-bold text-lg text-gray-800 mr-2" id="priceDisplay">₹{{price}}</span>
                                    <span class="text-gray-500 line-through" id="priceDiscount">₹{{(price|int * 10/7)|int}}</span>
                                    <span class="text-green-500 ml-2">30% off</span>
                                    <input type="text" class="hidden" name="price" id="price" value="{{price}}" required>
                                    <span class="font-bold hidden text-4xl leading-none align-baseline" id="priceStable">{{price}}</span>
                                </div>
                                <br>
                                <div>
                                    <div class="border-t border-b text-start w-full md:pl-[20%] border-gray-300 pt-2" onload="getAddress()" id="shippingAddress">
                                    </div>
                                </div>
                                <div class="inline-block align-bottom">
                                    <!-- <a href="/{{tshirtId}}=t/{{printId}}=p/{{type}}/{{source}}/payments" id="buyNowBtn"> -->
                                    <button type="submit" class="bg-yellow-300 opacity-80
                        hover:opacity-100 text-yellow-900 hover:text-black-900 my-2 mx-2 rounded-full px-10 py-2
                        font-semibold"><i class="" ></i> BUY NOW
                    </button>
                                    <!-- </a> -->
                                    <!-- <a href="/cart/add/{{tshirtId}}/{{printId}}/{{type}}"> -->
                                    {% if source=="noCart" %}
                                    <button type="button" id="addtocart" disabled onclick="cart()" class="bg-white opacity-60
                        hover:opacity-100 text-yellow-900 my-2 mx-2 hover:text-black-900 rounded-full px-10 py-2 font-semibold"><i class="mdi mdi-cart -ml-2 mr-2" ></i> ADD CART</button>{% else %}
                                    <a href="/carts"><button type="button" id=""  class="bg-white opacity-60
                        hover:opacity-100 text-yellow-900 my-2 mx-2 hover:text-black-900 rounded-full px-10 py-2 font-semibold"><i class="mdi mdi-cart -ml-2 mr-2" ></i> EDIT CART</button></a> {% endif %}
                                    <!-- </a> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
    </div>


    <!-- BUY ME A BEER AND HELP SUPPORT OPEN-SOURCE RESOURCES -->
    <div class="flex items-end justify-end fixed top-32 right-0 mb-4 mr-4 z-10">

        <div id="toast-default" class=" hidden flex items-center p-4 w-full max-w-xs text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800" role="alert">
            <div class="inline-flex flex-shrink-0 justify-center items-center w-8 h-8 text-blue-500 bg-blue-100 rounded-lg dark:bg-blue-800 dark:text-blue-200">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clipRule="evenodd"></path></svg>
                <span class="sr-only">Fire icon</span>
            </div>
            <div class="ml-3 text-sm font-normal" id="msgDisplay"></div>
            <button type="button" class="alert-del ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700"
                data-bs-dismiss="#toast-default" data-dismiss-target="#toast-default" aria-label="Close">
    <span class="sr-only">Close</span>
    <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd"></path></svg>
</button>
        </div>
        <!-- <div>
            <a title="Buy me a beer" href="https://www.buymeacoffee.com/scottwindon" target="_blank" class="block w-16 h-16 rounded-full transition-all shadow hover:shadow-lg transform hover:scale-110 hover:rotate-12">
                <img class="object-cover object-center w-full h-full rounded-full" src="https://i.pinimg.com/originals/60/fd/e8/60fde811b6be57094e0abc69d9c2622a.jpg" />
            </a>
        </div> -->
    </div>
</div>

<p class="hidden" id="tshirtId">{{tshirtId}}</p>
<p class="hidden" id="printId">{{printId}}</p>
<p class="hidden" id="answerId">{{answerId}}</p>
<p class="hidden" id="type">{{type}}</p>
<p class="hidden" id="custId">{{data.publicId}}</p>

{% endblock %} {% block script %} {% if type =="self" %}
<!-- <script>
    document.getElementById("buyNowBtn").setAttribute("href", `/${document.getElementById("tshirtId").innerHTML}=t/${document.getElementById("printId").innerHTML}=p/address=confirm/customize`)
</script> -->
{% elif type=="default" %}
<!-- <script>
    document.getElementById("buyNowBtn").setAttribute("href", `/${document.getElementById("tshirtId").innerHTML}=t/${document.getElementById("printId").innerHTML}=p/address=confirm/default`)
</script> -->

{% endif %}

<script>
    let colorDisplay = document.getElementById("colorDisplay");
    let colorInput = document.getElementById("colour");
    let Quantity = document.getElementById("quantity");
    let quantityDisplay = document.getElementById("quantityDisplay");
    let alertMsg = document.getElementById("toast-default");
    let msgDisplay = document.getElementById("msgDisplay");

    colorInput.addEventListener("change", () => {
        colorDisplay.style.backgroundColor = colorInput.value;
    });
    const update = () => {
        // console.log(document.getElementById("priceStable").innerText, Quantity.value)
        price = parseInt(document.getElementById("priceStable").innerText) * Quantity.value;
        document.getElementById("priceDisplay").innerText = "₹" + price;
        document.getElementById("price").value = price;
        document.getElementById("priceDiscount").innerText = "₹" + parseInt(price * 10 / 7);
    }
    const qunatityUpdate = (plusminus) => {

        const quant = parseInt(Quantity.value)
        if (plusminus == "plus") {

            Quantity.value = quant + 1;
            quantityDisplay.value = quant + 1;
        } else {
            if (quant == 1) {
                Quantity.value = 1;
                quantityDisplay.value = 1;

            } else {
                Quantity.value = quant - 1;
                quantityDisplay.value = quant - 1;
            }
        }

        update();
    }

    getAddress()



    function getAddress() {
        fetch(`/checkout/get/address`)
            .then(res => res.json()).
        then(data => {

            if (data["code"] == 200) {
                document.getElementById("shippingAddress").innerHTML =
                    ` <h3 class="text-xl font-bold mb-4 text-gray-800" >Shipping Address</h3>
                    <p class="text-gray-900 font-semibold mb-2">${data.name},</p>
                <p class="text-gray-700 mb-2">${data.address1},</p>
                <p class="text-gray-700 mb-2">${data.address2},</p>
                <p class="text-gray-700 mb-2">${data.city},</p>
                <p class="text-gray-700 mb-2">${data.state}, ${data.zip}.</p>`
            }
        })

    }

    console.log(document.getElementById("size").value != "", document.getElementById("colour").value != "");
    document.getElementById("addtocart").removeAttribute("disabled");

    function cart() {
        if (document.getElementById("size").value != "" && document.getElementById("colour").value != "") {

            url = `/cart/add/${document.getElementById("custId").innerText}/0`;
            // Create a form using FormData. This holds key value pairs.
            var formdata = new FormData();

            // Add a key value pair ("snap", file) to the FormData object. file is the original file passed sent to the upload function.
            formdata.append("tshirtId", document.getElementById("tshirtId").innerText);
            formdata.append("printId", document.getElementById("printId").innerText);
            formdata.append("answerId", document.getElementById("answerId").innerText);
            formdata.append("type", document.getElementById("type").innerText);
            formdata.append("details", document.getElementById("details").value);
            formdata.append("colour", document.getElementById("colour").value);
            formdata.append("size", document.getElementById("size").value);
            formdata.append("price", document.getElementById("price").value);
            formdata.append("quantity", document.getElementById("quantity").value);

            fetch(url, {
                    method: 'POST',
                    body: formdata,
                }).then((response) => response.json())
                .then((data) => {

                    if (data.code == 200) {
                        console.log(data);
                        alertMsg.classList.remove("hidden");
                        msgDisplay.innerText = data.msg;

                    } else {
                        alertMsg.classList.remove("hidden");
                        msgDisplay.innerText = data.msg;
                    }

                })
                .catch((error) => {
                    console.error('Error:', error);
                });

        } else {
            alertMsg.classList.remove("hidden");
            msgDisplay.innerText = "Pls fill all fields"
        }
    }
</script>
{% endblock %}